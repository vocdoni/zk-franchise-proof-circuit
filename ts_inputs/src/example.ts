import { groth16 } from "snarkjs";

import { GenerateCircuitInputs } from "./inputs.js";

(async function () {
    const start = Date.now();

    const apiInputs = {
        availableWeight: "10",
        sikRoot: "18608949345323673362225348588676685961425895169581337342907246759623660101058",
        sikSiblings: ["7895775351568888363770582083103224996276245414626073166815481571114078153790", "140172540063507229347028478508960612106770579931787386539932251076579868148", "21227379707922608938452775458173174601021420159905974194938744664631730085025", "0", "0", "0", "5251852105667611916720803906833529695818627904698090644173692751929343505574", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"],
        censusRoot: "19186891994317914485833726575482673091979651483055563895842185036337187462365",
        censusSiblings: ["20582266815761942359561706597553850040852798106838756022724849487502456935767", "10512157644086105704980926893223970791952714720387685020018630686442068039531", "13360533176360351052133429332744307373947762436358000865207405793024615061699", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"]
    }

    const clientInputs = {
        electionId: "7faeab7a7d250527d614e952ae8e446825bd1124c6def410844c7c383d1519a6",
        address: "6219a57380879971523440A215c88EabECf167e3",
        password: "",
        signature: "19400af6f71ffd8c28f1769570e9894e90a17d87dbc1b94500f7388d319246306dbdb8e26be5100ca624369633e29be7ca635d19bda6c97b98fc3efe1e0661c800",
        voteWeight: "5",
    }

    // computing full inputs including those that come from the API
    console.log("generating inputs");
    const inputs = await GenerateCircuitInputs(
        // client inputs
        clientInputs.electionId, clientInputs.address, clientInputs.password, clientInputs.signature, clientInputs.voteWeight, 
        // api inputs    
        apiInputs.availableWeight, apiInputs.sikRoot, apiInputs.sikSiblings, apiInputs.censusRoot, apiInputs.censusSiblings
    );
    console.log("inputs done");
    console.log("generating proof");
    await groth16.fullProve(
        inputs, 
        "../artifacts/zkCensus/dev/160/circuit.wasm", 
        "../artifacts/zkCensus/dev/160/proving_key.zkey"
    );
    console.log("proof done");
    const end = Date.now();
    console.log(`proof took ${(end - start) / 1000}s`);
})();

