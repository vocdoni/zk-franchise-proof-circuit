<body>

  <h1>Snarkjs client example</h1>
  <button id="bGenProof"> Create proof </button>

  <!-- JS-generated output will be added here. -->
  <pre class="proof"> PublicInputs: <code id="pubinputs"></code></pre>
  <pre class="proof"> Proof: <code id="proof"></code></pre>

  <pre class="proof"> Result: <code id="result"></code></pre>


  <script src="witness_calculator_bundle.js">   </script>
  <script src="snarkjs.min.js">   </script>

  <script>
    async function load_wasm(url) {
      return await fetch(url).then(response =>
	response.arrayBuffer()
	);
    }

const pubinputsComponent = document.getElementById('pubinputs');
const proofComponent = document.getElementById('proof');
const resultComponent = document.getElementById('result');
const bGenProof = document.getElementById("bGenProof");

bGenProof.addEventListener("click", calculateProof);

async function calculateProof() {

  const inputs = {
	  censusRoot: 13256983273841966279055596043431919350426357891097196583481278449962353221936n,
	  censusSiblings: [ 0n, 0n, 0n, 0n],
	  index: 0n,
	  secretKey: 3876493977147089964395646989418653640709890493868463039177063670701706079087n,
	  voteHash: [302689215824177652345211539748426020171n, 205062086841587857568430695525160476881n],
	  processId: [242108076058607163538102198631955675649n, 142667662805314151155817304537028292174n],
	  nullifier: 9464482416872469446849476841635888299250846240473623349595304484954843565595n
    };

    let wasmBuff = await load_wasm("circuit.wasm");
    let witnessCalculator = await WitnessCalc(wasmBuff);
    let wtnsBuff = await witnessCalculator.calculateWTNSBin(inputs,0);
    const { proof, publicSignals } =
      await snarkjs.groth16.prove("circuit_final.zkey", wtnsBuff);

    <!-- fullProve is not ready yet in snarkjs -->
    <!-- const { proof, publicSignals } = -->
    <!--   await snarkjs.groth16.fullProve(inputs, "circuit.wasm", "circuit_final.zkey"); -->

    proofComponent.innerHTML = JSON.stringify(proof, null, 1);
    pubinputsComponent.innerHTML = JSON.stringify(publicSignals, null, 1);


    const vkey = await fetch("verification_key.json").then( function(res) {
        return res.json();
    });

    const res = await snarkjs.groth16.verify(vkey, publicSignals, proof);

    resultComponent.innerHTML = res;
}

  </script>

</body>
</html>
