<html>
<body>

	<h1>Snarkjs client example</h1>
	<button id="bGenProof"> Create proof </button>

	<!-- JS-generated output will be added here. -->
	<pre class="proof"> PublicInputs: <code id="pubinputs"></code></pre>
	<pre class="proof"> Proof: <code id="proof"></code></pre>

	<pre class="proof"> Result: <code id="result"></code></pre>


	<script src="./release/witness_calculator_bundle.js"></script>
	<script src="./release/snarkjs.min.js"></script>

	<script>
		async function load_wasm(url) {
			return await fetch(url).then(response => response.arrayBuffer());
		}

		const pubinputsComponent = document.getElementById('pubinputs');
		const proofComponent = document.getElementById('proof');
		const resultComponent = document.getElementById('result');
		const bGenProof = document.getElementById("bGenProof");

		bGenProof.addEventListener("click", calculateProof);

		async function calculateProof() {
			const inputs = {
				censusRoot: 14136667367502319148615490207755272784185174173180654933427054252605616162100n,
				censusSiblings: [ 0n, 0n, 0n, 0n, 0n],
				weight: 1n,
				privateKey: 6190793965647866647574058687473278714480561351424348391693421151024369116465n,
				voteHash: [302689215824177652345211539748426020171n, 205062086841587857568430695525160476881n],
				processId: [242108076058607163538102198631955675649n, 142667662805314151155817304537028292174n],
				nullifier: 4295509861249984880361571032347194270863089509149412623993065795982837479793n
			};

			let wasmBuff = await load_wasm("release/circuit.wasm");
			let witnessCalculator = await WitnessCalc(wasmBuff);
			let wtnsBuff = await witnessCalculator.calculateWTNSBin(inputs,0);
			const { proof, publicSignals } =
			await snarkjs.groth16.prove("release/circuit.zkey", wtnsBuff);

			<!-- fullProve is not ready yet in snarkjs -->
			<!-- const { proof, publicSignals } = -->
			<!--   await snarkjs.groth16.fullProve(inputs, "release/circuit.wasm", "release/circuit.zkey"); -->

			proofComponent.innerHTML = JSON.stringify(proof, null, 1);
			pubinputsComponent.innerHTML = JSON.stringify(publicSignals, null, 1);


			const vkey = await fetch("release/verification_key.json").then( function(res) {
				return res.json();
			});

			const res = await snarkjs.groth16.verify(vkey, publicSignals, proof);

			resultComponent.innerHTML = res;
		}

	</script>

</body>
</html>